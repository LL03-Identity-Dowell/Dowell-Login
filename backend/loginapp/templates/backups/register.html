{% load static %}
<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>Register</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.2.3/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-rbsA2VBKQhggwzxH7pPCaAqO46MgnOM80zW1RWuH61DGLwZJEdK2Kadq2F9CUG65" crossorigin="anonymous">
    <link href="{% static 'css/styles.css' %}" rel="stylesheet">
    <script src="{% static 'script/script.js'%}"></script>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.6.4/jquery.min.js"></script>
  </head>
  <body>
    <div class="container mt-5">
        <div class="row">
              <div class="col-xs-0 col-sm-0 col-md-2 col-lg-3"></div>
              <div class="col-xs-12 col-sm-12 col-md-8 col-lg-6">
                  <div class="card border border-0">
                      <div class="text-center">
                        <img src="{% static 'img/artistic-logo-150x150.png'%}" class="rounded" alt="logo">
                      </div>
                      <div class="card-title p-3 text-center">
                          <h2 class="memberHeading">Join as new Member</h2>
                      </div>
                      <div class="card-body">
                        <form method="post" name="frmRecord" enctype="multipart/form-data" onSubmit="return form_validation()">
                          {% csrf_token %}
                          <input type="text" name="org" value="{{org}}" hidden>
                          <input type="text" name="type" value="{{add_org.type}}"
                              hidden>
                          <input type="text" id="mainparams" name="mainparams"
                              value="" hidden>
                          <input type="text" id="otp_status" name="otp_status"
                              value="" hidden>
                          <input type="text" id="sms_status" name="sms_status"
                              value="" hidden>
                            <div class="mb-3">
                              <label for="first_name" class="form-label text-success fst-italic">First Name <span class="text-danger">*</span></label>
                              <input type="text" class="form-control" title="Only alphabets are allowed" name="first_name" id="first_name" name="first_name" placeholder="Your first name" pattern="[a-zA-Z]*" required>
                            </div>
                            <div class="mb-3">
                              <label for="lastName" class="form-label text-success fst-italic">Last Name <span class="text-danger">*</span></label>
                              <input type="text" class="form-control" title="Only alphabets are allowed" id="last_name" name="last_name" placeholder="Your last name" pattern="[a-zA-Z]*" required>
                            </div>
                            <div class="mb-3">
                              <label for="userType" class="form-label text-success fst-italic">User Type <span class="text-danger">*</span></label>
                              <select required class="form-select form-control" id="userType" title="Please select an item in the list.">
                                  <option selected value="liveuser">Live User</option>
                                  <option value="1" value="betatester">Beta Tester</option>
                              </select>
                            </div>
                            <div class="mb-3">
                              <label for="username" class="form-label text-success fst-italic">User Name <span class="text-danger">*</span></label>
                              <input type="text" class="form-control" title="Please fill out this field." id="username" name="username" minlength="8" placeholder="Enter your user name" required>
                            </div>
                            <div class="mb-3">
                              <label for="password1" class="form-label text-success fst-italic">Password  <span class="text-danger">*</span></label>
                              <input type="password" class="form-control" title="Please fill out this field." name="password1" id="password1" placeholder="Enter your password" required>
                            </div>
                            <div class="mb-3">
                              <label for="password2" class="form-label text-success fst-italic">Re enter password  <span class="text-danger">*</span></label>
                              <input type="password" class="form-control" title="Please fill out this field." id="password2" name="password2" placeholder="Confirm password" required>
                            </div>
                            <div class="mb-3">
                              <label for="countrySelect" class="form-label text-success fst-italic">Country  <span class="text-danger">*</span></label>
                              <select class="form-select form-control" id="user_country" name="user_country" title="Please select an item in the list." required>
                                <option value="">Select your country..
                                </option>
                                <option value="Afghanistan">Afghanistan
                                </option>
                                <option value="Albania">Albania</option>
                                <option value="Algeria">Algeria</option>
                                <option value="American Samoa">American
                                    Samoa</option>
                                <option value="Andorra">Andorra</option>
                                <option value="Angola">Angola</option>
                                <option value="Anguilla">Anguilla</option>
                                <option value="Antartica">Antarctica
                                </option>
                                <option value="Antigua and Barbuda">Antigua
                                    and Barbuda</option>
                                <option value="Argentina">Argentina</option>
                                <option value="Armenia">Armenia</option>
                                <option value="Aruba">Aruba</option>
                                <option value="Australia">Australia</option>
                                <option value="Austria">Austria</option>
                                <option value="Azerbaijan">Azerbaijan
                                </option>
                                <option value="Bahamas">Bahamas</option>
                                <option value="Bahrain">Bahrain</option>
                                <option value="Bangladesh">Bangladesh
                                </option>
                                <option value="Barbados">Barbados</option>
                                <option value="Belarus">Belarus</option>
                                <option value="Belgium">Belgium</option>
                                <option value="Belize">Belize</option>
                                <option value="Benin">Benin</option>
                                <option value="Bermuda">Bermuda</option>
                                <option value="Bhutan">Bhutan</option>
                                <option value="Bolivia">Bolivia</option>
                                <option value="Bosnia and Herzegowina">
                                    Bosnia and Herzegowina</option>
                                <option value="Botswana">Botswana</option>
                                <option value="Bouvet Island">Bouvet Island
                                </option>
                                <option value="Brazil">Brazil</option>
                                <option
                                    value="British Indian Ocean Territory">
                                    British Indian Ocean Territory</option>
                                <option value="Brunei Darussalam">Brunei
                                    Darussalam</option>
                                <option value="Bulgaria">Bulgaria</option>
                                <option value="Burkina Faso">Burkina Faso
                                </option>
                                <option value="Burundi">Burundi</option>
                                <option value="Cambodia">Cambodia</option>
                                <option value="Cameroon">Cameroon</option>
                                <option value="Canada">Canada</option>
                                <option value="Cape Verde">Cape Verde
                                </option>
                                <option value="Cayman Islands">Cayman
                                    Islands</option>
                                <option value="Central African Republic">
                                    Central African Republic</option>
                                <option value="Chad">Chad</option>
                                <option value="Chile">Chile</option>
                                <option value="China">China</option>
                                <option value="Christmas Island">Christmas
                                    Island</option>
                                <option value="Cocos Islands">Cocos
                                    (Keeling) Islands</option>
                                <option value="Colombia">Colombia</option>
                                <option value="Comoros">Comoros</option>
                                <option value="Congo">Congo</option>
                                <option value="Congo">Congo, the Democratic
                                    Republic of the</option>
                                <option value="Cook Islands">Cook Islands
                                </option>
                                <option value="Costa Rica">Costa Rica
                                </option>
                                <option value="Cota D'Ivoire">Cote d'Ivoire
                                </option>
                                <option value="Croatia">Croatia (Hrvatska)
                                </option>
                                <option value="Cuba">Cuba</option>
                                <option value="Cyprus">Cyprus</option>
                                <option value="Czech Republic">Czech
                                    Republic</option>
                                <option value="Denmark">Denmark</option>
                                <option value="Djibouti">Djibouti</option>
                                <option value="Dominica">Dominica</option>
                                <option value="Dominican Republic">Dominican
                                    Republic</option>
                                <option value="East Timor">East Timor
                                </option>
                                <option value="Ecuador">Ecuador</option>
                                <option value="Egypt">Egypt</option>
                                <option value="El Salvador">El Salvador
                                </option>
                                <option value="Equatorial Guinea">Equatorial
                                    Guinea</option>
                                <option value="Eritrea">Eritrea</option>
                                <option value="Estonia">Estonia</option>
                                <option value="Ethiopia">Ethiopia</option>
                                <option value="Falkland Islands">Falkland
                                    Islands (Malvinas)</option>
                                <option value="Faroe Islands">Faroe Islands
                                </option>
                                <option value="Fiji">Fiji</option>
                                <option value="Finland">Finland</option>
                                <option value="France">France</option>
                                <option value="France Metropolitan">France,
                                    Metropolitan</option>
                                <option value="French Guiana">French Guiana
                                </option>
                                <option value="French Polynesia">French
                                    Polynesia</option>
                                <option value="French Southern Territories">
                                    French Southern Territories</option>
                                <option value="Gabon">Gabon</option>
                                <option value="Gambia">Gambia</option>
                                <option value="Georgia">Georgia</option>
                                <option value="Germany">Germany</option>
                                <option value="Ghana">Ghana</option>
                                <option value="Gibraltar">Gibraltar</option>
                                <option value="Greece">Greece</option>
                                <option value="Greenland">Greenland</option>
                                <option value="Grenada">Grenada</option>
                                <option value="Guadeloupe">Guadeloupe
                                </option>
                                <option value="Guam">Guam</option>
                                <option value="Guatemala">Guatemala</option>
                                <option value="Guinea">Guinea</option>
                                <option value="Guinea-Bissau">Guinea-Bissau
                                </option>
                                <option value="Guyana">Guyana</option>
                                <option value="Haiti">Haiti</option>
                                <option value="Heard and McDonald Islands">
                                    Heard and Mc Donald Islands</option>
                                <option value="Holy See">Holy See (Vatican
                                    City State)</option>
                                <option value="Honduras">Honduras</option>
                                <option value="Hong Kong">Hong Kong</option>
                                <option value="Hungary">Hungary</option>
                                <option value="Iceland">Iceland</option>
                                <option value="India">India</option>
                                <option value="Indonesia">Indonesia</option>
                                <option value="Iran">Iran (Islamic Republic
                                    of)</option>
                                <option value="Iraq">Iraq</option>
                                <option value="Ireland">Ireland</option>
                                <option value="Israel">Israel</option>
                                <option value="Italy">Italy</option>
                                <option value="Jamaica">Jamaica</option>
                                <option value="Japan">Japan</option>
                                <option value="Jordan">Jordan</option>
                                <option value="Kazakhstan">Kazakhstan
                                </option>
                                <option value="Kenya">Kenya</option>
                                <option value="Kiribati">Kiribati</option>
                                <option
                                    value="Democratic People's Republic of Korea">
                                    Korea, Democratic People's Republic of
                                </option>
                                <option value="Korea">Korea, Republic of
                                </option>
                                <option value="Kuwait">Kuwait</option>
                                <option value="Kyrgyzstan">Kyrgyzstan
                                </option>
                                <option value="Lao">Lao People's Democratic
                                    Republic</option>
                                <option value="Latvia">Latvia</option>
                                <option value="Lebanon">Lebanon</option>
                                <option value="Lesotho">Lesotho</option>
                                <option value="Liberia">Liberia</option>
                                <option value="Libyan Arab Jamahiriya">
                                    Libyan Arab Jamahiriya</option>
                                <option value="Liechtenstein">Liechtenstein
                                </option>
                                <option value="Lithuania">Lithuania</option>
                                <option value="Luxembourg">Luxembourg
                                </option>
                                <option value="Macau">Macau</option>
                                <option value="Macedonia">Macedonia, The
                                    Former Yugoslav Republic of</option>
                                <option value="Madagascar">Madagascar
                                </option>
                                <option value="Malawi">Malawi</option>
                                <option value="Malaysia">Malaysia</option>
                                <option value="Maldives">Maldives</option>
                                <option value="Mali">Mali</option>
                                <option value="Malta">Malta</option>
                                <option value="Marshall Islands">Marshall
                                    Islands</option>
                                <option value="Martinique">Martinique
                                </option>
                                <option value="Mauritania">Mauritania
                                </option>
                                <option value="Mauritius">Mauritius</option>
                                <option value="Mayotte">Mayotte</option>
                                <option value="Mexico">Mexico</option>
                                <option value="Micronesia">Micronesia,
                                    Federated States of</option>
                                <option value="Moldova">Moldova, Republic of
                                </option>
                                <option value="Monaco">Monaco</option>
                                <option value="Mongolia">Mongolia</option>
                                <option value="Montserrat">Montserrat
                                </option>
                                <option value="Morocco">Morocco</option>
                                <option value="Mozambique">Mozambique
                                </option>
                                <option value="Myanmar">Myanmar</option>
                                <option value="Namibia">Namibia</option>
                                <option value="Nauru">Nauru</option>
                                <option value="Nepal">Nepal</option>
                                <option value="Netherlands">Netherlands
                                </option>
                                <option value="Netherlands Antilles">
                                    Netherlands Antilles</option>
                                <option value="New Caledonia">New Caledonia
                                </option>
                                <option value="New Zealand">New Zealand
                                </option>
                                <option value="Nicaragua">Nicaragua</option>
                                <option value="Niger">Niger</option>
                                <option value="Nigeria">Nigeria</option>
                                <option value="Niue">Niue</option>
                                <option value="Norfolk Island">Norfolk
                                    Island</option>
                                <option value="Northern Mariana Islands">
                                    Northern Mariana Islands</option>
                                <option value="Norway">Norway</option>
                                <option value="Oman">Oman</option>
                                <option value="Pakistan">Pakistan</option>
                                <option value="Palau">Palau</option>
                                <option value="Panama">Panama</option>
                                <option value="Papua New Guinea">Papua New
                                    Guinea</option>
                                <option value="Paraguay">Paraguay</option>
                                <option value="Peru">Peru</option>
                                <option value="Philippines">Philippines
                                </option>
                                <option value="Pitcairn">Pitcairn</option>
                                <option value="Poland">Poland</option>
                                <option value="Portugal">Portugal</option>
                                <option value="Puerto Rico">Puerto Rico
                                </option>
                                <option value="Qatar">Qatar</option>
                                <option value="Reunion">Reunion</option>
                                <option value="Romania">Romania</option>
                                <option value="Russia">Russian Federation
                                </option>
                                <option value="Rwanda">Rwanda</option>
                                <option value="Saint Kitts and Nevis">Saint
                                    Kitts and Nevis</option>
                                <option value="Saint LUCIA">Saint LUCIA
                                </option>
                                <option value="Saint Vincent">Saint Vincent
                                    and the Grenadines</option>
                                <option value="Samoa">Samoa</option>
                                <option value="San Marino">San Marino
                                </option>
                                <option value="Sao Tome and Principe">Sao
                                    Tome and Principe</option>
                                <option value="Saudi Arabia">Saudi Arabia
                                </option>
                                <option value="Senegal">Senegal</option>
                                <option value="Seychelles">Seychelles
                                </option>
                                <option value="Sierra">Sierra Leone</option>
                                <option value="Singapore">Singapore</option>
                                <option value="Slovakia">Slovakia (Slovak
                                    Republic)</option>
                                <option value="Slovenia">Slovenia</option>
                                <option value="Solomon Islands">Solomon
                                    Islands</option>
                                <option value="Somalia">Somalia</option>
                                <option value="South Africa">South Africa
                                </option>
                                <option value="South Georgia">South Georgia
                                    and the South Sandwich Islands</option>
                                <option value="Span">Spain</option>
                                <option value="SriLanka">Sri Lanka</option>
                                <option value="St. Helena">St. Helena
                                </option>
                                <option value="St. Pierre and Miguelon">St.
                                    Pierre and Miquelon</option>
                                <option value="Sudan">Sudan</option>
                                <option value="Suriname">Suriname</option>
                                <option value="Svalbard">Svalbard and Jan
                                    Mayen Islands</option>
                                <option value="Swaziland">Swaziland</option>
                                <option value="Sweden">Sweden</option>
                                <option value="Switzerland">Switzerland
                                </option>
                                <option value="Syria">Syrian Arab Republic
                                </option>
                                <option value="Taiwan">Taiwan, Province of
                                    China</option>
                                <option value="Tajikistan">Tajikistan
                                </option>
                                <option value="Tanzania">Tanzania, United
                                    Republic of</option>
                                <option value="Thailand">Thailand</option>
                                <option value="Togo">Togo</option>
                                <option value="Tokelau">Tokelau</option>
                                <option value="Tonga">Tonga</option>
                                <option value="Trinidad and Tobago">Trinidad
                                    and Tobago</option>
                                <option value="Tunisia">Tunisia</option>
                                <option value="Turkey">Turkey</option>
                                <option value="Turkmenistan">Turkmenistan
                                </option>
                                <option value="Turks and Caicos">Turks and
                                    Caicos Islands</option>
                                <option value="Tuvalu">Tuvalu</option>
                                <option value="Uganda">Uganda</option>
                                <option value="Ukraine">Ukraine</option>
                                <option value="United Arab Emirates">United
                                    Arab Emirates</option>
                                <option value="United Kingdom">United
                                    Kingdom</option>
                                <option value="United States">United States
                                </option>
                                <option
                                    value="United States Minor Outlying Islands">
                                    United States Minor Outlying Islands
                                </option>
                                <option value="Uruguay">Uruguay</option>
                                <option value="Uzbekistan">Uzbekistan
                                </option>
                                <option value="Vanuatu">Vanuatu</option>
                                <option value="Venezuela">Venezuela</option>
                                <option value="Vietnam">Viet Nam</option>
                                <option value="Virgin Islands (British)">
                                    Virgin Islands (British)</option>
                                <option value="Virgin Islands (U.S)">Virgin
                                    Islands (U.S.)</option>
                                <option value="Wallis and Futana Islands">
                                    Wallis and Futuna Islands</option>
                                <option value="Western Sahara">Western
                                    Sahara</option>
                                <option value="Yemen">Yemen</option>
                                <option value="Serbia">Serbia</option>
                                <option value="Zambia">Zambia</option>
                                <option value="Zimbabwe">Zimbabwe</option>
                                </select>
                            </div>
                            <div class="mb-3">
                              <label for="phonecode" class="form-label text-success fst-italic">Country Code  <span class="text-danger">*</span></label>
                              <select class="form-select form-control" id="phonecode" name="phonecode" title="Please select an item in the list." required>
                                {% for x,y in country_resp %}
                                <option value="{{x}}">{{y}}</option>
                                {%endfor%}
                                <option value="+977">NEP(+977)</option>
                                </select>
                            </div>
                            <div class="mb-3">
                              <label for="phone" class="form-label text-success fst-italic">Phone  <span class="text-danger">*</span></label>
                              <input type="number" class="form-control" title="Onlu numbera and phone characters (#, -, *, etc) are accepted." pattern="[0-9()#&amp;+*-=.]+" id="phone" name="phone" placeholder="Your phone number" required>
                            </div>
                            <div class="mb-3">
                              <input id="sms_btn" type="button" value="Get OTP"/>
                              <div style=" margin-left:2%;color:red;height:30%"
                              id="output1"></div>
                              <div style=" margin-left:2%;color:green;height:30%"
                              id="success1"></div>
                            </div>
                            <div class="mb-3">
                              <label for="sms" class="form-label text-success fst-italic">Enter OTP from SMS  <span class="text-danger">*</span></label>
                              <input type="number" class="form-control" title="Onlu numbera and phone characters (#, -, *, etc) are accepted." pattern="[0-9()#&amp;+*-=.]+" id="sms" name="sms" placeholder="OTP from SMS" required>
                            </div>
                            
                            <div class="mb-3">
                              <input style="display:none" type="button" id="sms_verify" value="Verify SMS">
                              <div style=" margin-left:2%;color:red;height:30%"
                                  id="output_sms"></div>
                              <div style=" margin-left:2%;color:green;height:30%"
                                  id="success_sms"></div>
                            </div>
                            
                            <div class="mb-3">
                              <label for="photo" class="form-label text-success fst-italic">Your Photo</label><br/>
                              <input type="file" title="Choose your clear photo." accept="image/*" id="profile_image" placeholder="Product Logo">
                            </div>
                            <div class="mb-3">
                              <label for="email" class="form-label text-success fst-italic">Email  <span class="text-danger">*</span></label>
                              <input type="email" class="form-control" title="Please fill out this field." id="email" name="email" placeholder="Your email" required>
                            </div>
                          
                            <div class="mb-3">
                              <input style="display:block;" type="button" id="otp_btn" value="Get OTP"/>
                              <div style=" margin-left:2%;color:red;height:30%"
                              id="output"></div>
                              <div style=" margin-left:2%;color:green;height:30%"
                              id="success"></div>
                            </div>
                            <div class="mb-3">
                              <label for="otp" class="form-label text-success fst-italic">Enter OTP from email  <span class="text-danger">*</span></label>
                              <input type="text" class="form-control" title="Please fill out this field." id="otp" name="otp" placeholder="Enter OTP recieved in your email" required>
                            </div>

                            <div class="mb-3">
                              <input type="button" style="display:none" id="otp_verify" value="Verify OTP">
                              
                              <div style=" margin-left:2%;color:red;height:30%"
                              id="output_otp"></div>
                              <div style=" margin-left:2%;color:green;height:30%"
                              id="success_otp"></div>
                            </div>
                            
                            <div class="mb-3">
                              <div class="form-check">
                                <label class="form-check-label checkText" for="policyCheck">Do you accept our <a href="javascript:view_policy()" class="policyLink" id="view_policy">policies?</a></label>
                                <input type="checkbox" id="policy_status" name="policy_status" value="Accepted"><br>
                                <span style="margin-left: 2%;display: none;" id="policy_output"></span>
                              </div>

                              <div class="form-check">
                                <label class="form-check-label checkText" for="secCheck">Do you accept our safety and security policies?</label>
                                <input type="checkbox" name="other_policy" value="Accepted">
                              </div>

                              <div class="form-check">
                                <label class="form-check-label checkText" for="newsCheck">Do you want to subscribe to our newsletter? </label>
                                <input type="checkbox" name="newsletter" value="Accepted">
                              </div>
                              <div class="mb-3">
                                <iframe id="for_policy"
                                style="display:none;border-radius:4px; padding:3px;border: #0A8303 solid; margin-top:10px;margin-bottom:20px;border-width: thin;"
                                loading="lazy"
                                src="https://100087.pythonanywhere.com/legalpolicies/FB1010000000167475042357408025/website-privacy-policy/policies/"
                                allow="fullscreen" width="400"
                                ></iframe>
                              </div>
                              <center><span style="color:red" id="error_msg"></span>
                              </center>
                            </div>
                            <div class="d-grid gap-2">
                              <button  type="submit" class="btn joinMemberBtn">Join as new member</button>
                              <button class="btn joinMemberBtn mt-5 ms-auto me-auto haveAccountBtn" type="button" onclick="loadSignInPage()">Do you have an account? Sign in</button>
                            </div>
                        </form>
                      </div>
                  </div>
              </div>
              <div class="col-xs-0 col-sm-0 col-md-2 col-lg-3"></div>
        </div>
    </div>
      <script>
        $("#policy_status").change(function (e) {
            if (document.getElementById("username").value != "") {
                if (this.checked) {
                    e.preventDefault();
                    $.ajax({
                        type: "POST",
                        url:"{% url 'register_legal_policy'%}",
                        data: {
                            form: "policyform",
                            user: $('#username').val(),
                            csrfmiddlewaretoken: $('input[name=csrfmiddlewaretoken]').val(),
                            dataType: "json",
                        },
                        success: function (data) {
                          console.log(data)
                            if (data.msg != "") {
                                $('#policy_output').css("color", "green");
                                $('#policy_output').css("display", "block");
                                $('#policy_output').html("");
                                $('#policy_output').html(data.msg);
                            } else {
                                $("#policy_status").prop("checked", false);
                                $('#policy_output').css("display", "block");
                                $('#policy_output').css("color", "red");
                                $('#policy_output').html("");
                                $('#policy_output').html(data.error);
                            }

                        },

                        failure: function () {
                            $("#policy_status").prop("checked", false);
                            $('#policy_output').css("display", "block");
                            $('#policy_output').css("color", "red");
                            $('#policy_output').html("");
                            $('#policy_output').html(data.msg);
                        }
                    });

                }
            } else {
                $("#policy_status").prop("checked", false);
                $('#policy_output').css("display", "block");
                $('#policy_output').css("color", "red");
                $('#policy_output').html("Provide username to accept policy");
            };

        });
        function view_policy() {
            uname = document.getElementById("username").value;
            document.getElementById("for_policy").src = "https://100087.pythonanywhere.com/legalpolicies/FB1010000000167475042357408025/website-privacy-policy/policies/?redirect_url=https://100014.pythonanywhere.com/legalpolicy1?s=" + uname + "&session_id=" + uname;
            document.getElementById("for_policy").style.display = "block";
        };
        $('#id_password1, #id_password2').on('keyup', function () {
        if ($('#id_password1').val() == $('#id_password2').val()) {
            $('#mess').html('Matching').css('color', 'green');
        } else
            $('#mess').html('Not Matching').css('color', 'red');
        });

        $('#username').on('change', function () {
        if (["administrator", "uxlivinglab", "dowellresearch", "dowellteam", "admin"].includes($('#username').val())) {
            $('#user_error').html("This username is not allowed..");
            $('#username').val("");
        } else {
            $('#user_error').html("");
        }
      });
    </script>
    <script>
    var interval_otp;
    window.otp_timer_status= false;
    window.sms_timer_status= false;
    function otp_countdown() {
    window.otp_timer_status= true;
    clearInterval(interval_otp);
    interval_otp = setInterval(function () {
    var timer_otp = $('#js-timeout-otp').html();
    timer_otp = timer_otp.split(':');
    var minutes_otp = timer_otp[0];
    var seconds_otp = timer_otp[1];
    seconds_otp -= 1;
    if (minutes_otp < 0) return;
    else if (seconds_otp < 0 && minutes_otp != 0) {
    minutes_otp -= 1;
    seconds_otp = 59;
    }
    else if (seconds_otp < 10 && seconds_otp.toString().length != 2) seconds_otp = '0' + seconds_otp;

    $('#js-timeout-otp').html(minutes_otp + ':' + seconds_otp);

    if (minutes_otp == 0 && seconds_otp == 0) {
    window.otp_timer_status= false;
    clearInterval(interval_otp);
    console.log("over");
    $('#otp_btn').prop('disabled', false);
    };
    }, 1000);
    };

    var interval_sms;
    function sms_countdown() {
    window.sms_timer_status= true;
    clearInterval(interval_sms);
    interval_sms = setInterval(function () {
    var timer = $('#js-timeout-sms').html();
    timer = timer.split(':');
    var minutes = timer[0];
    var seconds = timer[1];
    seconds -= 1;
    if (minutes < 0) return;
    else if (seconds < 0 && minutes != 0) {
    minutes -= 1;
    seconds = 59;
    }
    else if (seconds < 10 && seconds.toString().length != 2) seconds = '0' + seconds;

    $('#js-timeout-sms').html(minutes + ':' + seconds);

    if (minutes == 0 && seconds == 0) {
    window.sms_timer_status= false;
    clearInterval(interval_sms);
    console.log("over");
    $('#sms_btn').prop('disabled', false);
    };
    }, 1000);
    };
    </script>
      <script type="text/javascript">
        var mainparams = ""
        let urlString = window.location.href;
        let paramString = urlString.split('?')[1];
        let queryString = new URLSearchParams(paramString);
        for (let pair of queryString.entries()) {
            mainparams = mainparams.concat(pair[0]);
            mainparams = mainparams.concat("=", pair[1], "&");
        }
        document.getElementById("mainparams").value = mainparams;
    </script>

    <script>
        var email_otp_remains = localStorage.getItem('email_otp_remains');
        var mobile_otp_remains = localStorage.getItem('mobile_otp_remains');
        var email_otp_restricted = localStorage.getItem('email_otp_restricted');
        var mobile_otp_restricted = localStorage.getItem('mobile_otp_restricted');
        if (email_otp_remains == null) {
            localStorage.setItem('email_otp_remains', 5)
        }
        else if (email_otp_remains == 0) {
            if (email_otp_restricted == null) {
                email_otp_restricted = Date()
            }
            email_diff = Date.parse(Date()) - Date.parse(email_otp_restricted)
            if (email_diff >= 300000) {
                $('#otp_btn').prop('disabled', false);
                localStorage.setItem("email_otp_remains", 5);
                email_otp_remains = localStorage.getItem('email_otp_remains');
                localStorage.removeItem('email_otp_restricted');
                $('#output').html("");
                $('#success').html("You can send otp now..");
            } else {
                setTimeout(function () {
                    $('#otp_btn').prop('disabled', false);
                    localStorage.setItem("email_otp_remains", 5);
                    email_otp_remains = localStorage.getItem('email_otp_remains');
                    localStorage.removeItem('email_otp_restricted');
                    $('#output').html("");
                    $('#success').html("You can send otp now..");
                }, 300 * 1000 - email_diff);
            }
        }
        if (mobile_otp_remains == null) {
            localStorage.setItem('mobile_otp_remains', 5)
        }
        else if (mobile_otp_remains == 0) {
            if (mobile_otp_restricted == null) {
                mobile_otp_restricted = Date()
            }
            mobile_diff = Date.parse(Date()) - Date.parse(mobile_otp_restricted)
            if (mobile_diff >= 300000) {
                $('#sms_btn').prop('disabled', false);
                localStorage.setItem("mobile_otp_remains", 5);
                mobile_otp_remains = localStorage.getItem('mobile_otp_remains');
                localStorage.removeItem('mobile_otp_restricted');
                $('#output1').html("");
                $('#success1').html("You can send otp now..");
            } else {
                setTimeout(function () {
                    $('#sms_btn').prop('disabled', false);
                    localStorage.setItem("mobile_otp_remains", 5);
                    mobile_otp_remains = localStorage.getItem('mobile_otp_remains');
                    localStorage.removeItem('mobile_otp_restricted');
                    $('#success1').html("You can send otp now..");
                }, 300 * 1000 - mobile_diff);
            }
        }
        var email_otp_remains = localStorage.getItem('email_otp_remains');
        var mobile_otp_remains = localStorage.getItem('mobile_otp_remains');
        $('#sms_btn').on('click', function (e) {
            $("#success1").html("");
            $("#output1").html("");
            $('#error_msg').html("");
            $('#output_sms').html("");
            $('#success_sms').html("");
            $("#sms_btn").prop("disabled", true);
            e.preventDefault();
            var phone1 = document.getElementById("phone").value;
            var phonecode1 = document.getElementById("phonecode").value;
            if (phone1 != "" && phonecode1 != "") {
                if (mobile_otp_remains >= 1) {
                    $.ajax({
                        type: "POST",
                        url: "{% url 'register' %}",
                        data: {
                            form: "mobileotp",
                            phonecode: $('#phonecode').val(),
                            phone: $('#phone').val(),
                            csrfmiddlewaretoken: '{{ csrf_token }}',
                            dataType: "json",
                        },
                        success: function (data) {
                            mobile_otp_remains--;
                            localStorage.setItem("mobile_otp_remains", mobile_otp_remains);
                            $('#output1').html("");
                            $('#sms_verify').css('display', 'block');
                            if (mobile_otp_remains < 1) {
                                $('#success1').html("SMS Sent Successfully!!" + "<br>" + "<span style='color:red'>No chances left, try after five minutes..</span>" + "<span style='color:red' id='sms_counter'></span>");
                                document.getElementById('sms_counter').innerHTML = " (" + mobile_otp_remains + " chances left)";
                                $('#sms_btn').val("Resend");
                                localStorage.setItem("mobile_otp_restricted", Date());
                                setTimeout(function () {
                                    $('#sms_btn').prop('disabled', false);
                                    localStorage.setItem("mobile_otp_remains", 5);
                                    mobile_otp_remains = localStorage.getItem('mobile_otp_remains');
                                    $('#success1').html("You can click Get OTP now..");
                                    localStorage.removeItem('mobile_otp_restricted');
                                }, 300 * 1000);
                            } else {
                                sms_countdown();
                                $('#success1').html("SMS Sent Successfully!! " + " Resend after " + "<span style='color:black' id='js-timeout-sms'>1:00</span> mins." + "<span style='color:red' id='sms_counter'></span>");
                                document.getElementById('sms_counter').innerHTML = " (" + mobile_otp_remains + " chances left)";
                                $('#sms_btn').val("Resend");
                            };
                        },
                        failure: function () {
                            $('#output1').html("Internal error")
                        }
                    });
                }
                else {
                    $("#sms_btn").prop("disabled", false);
                    $('#output1').html("5 tries passed,try after some time!")
                }
            } else {
                $("#sms_btn").prop("disabled", false);
                $('#output1').html("Enter both phone and phonecode for OTP!!")
            }
        });

        $('#sms_verify').on('click', function (e) {
            e.preventDefault();
            $('#error_msg').html("");
        if (!sms_timer_status){
        $('#success1').html("");
        }
            $('#output1').html("");
            var phone1 = document.getElementById("phone").value;
            var sms = document.getElementById("sms").value;
            var phonecode1 = document.getElementById("phonecode").value;
            if (phone1 != "" && sms != "" && phonecode1 != "") {
                $.ajax({
                    type: "POST",
                    url: "{% url 'register' %}",
                    data: {
                        form: 'verify_sms',
                        sms: $('#sms').val(),
                        phone: $('#phone').val(),
                        phonecode: $('#phonecode').val(),
                        csrfmiddlewaretoken: '{{ csrf_token }}',
                        dataType: "json",
                    },
                    success: function (data) {
                        if (data.verified == "True") {
                            $('#output_sms').html("")
                            $('#success_sms').html("OTP Verified Successfully!!")
                            $('#sms_status').val("verified")
                        }
                        else {
                            $('#success_sms').html("")
                            $('#output_sms').html("Wrong OTP..")
                            $('#sms').val("")
                            $('#sms_status').val("")
                        }
                    },

                    failure: function () {
                        $('#output_sms').html("Internal Error")
                    }
                });
            } else {
                $('#success_sms').html("")
                $('#output_sms').html("Enter both phone number and otp for verification!!")
            }
        });

        $('#otp_btn').on('click', function (e) {
            $("#success").html("");
            $("#output").html("");
            $('#error_msg').html("");
            $('#output_otp').html("");
            $('#success_otp').html("");
            $("#otp_btn").prop("disabled", true);
            e.preventDefault();
            var email1 = document.getElementById("email").value;
            var user1 = document.getElementById("username").value;
            if (email1 != "" && user1 != "") {
                if (email_otp_remains >= 1) {
                    $.ajax({
                        type: "POST",
                        url: "{% url 'register' %}",
                        data: {
                            username: $('#username').val(),
                            email: $('#email').val(),
                            csrfmiddlewaretoken: '{{ csrf_token }}',
                            dataType: "json",

                        },
                        success: function (data) {
                            email_otp_remains--;
                            localStorage.setItem("email_otp_remains", email_otp_remains);
                            $('#output').html("");
                            $('#otp_verify').css('display', 'block');
                            if (email_otp_remains < 1) {
                                $('#success').html("OTP Sent Successfully!!" + "<br>" + "<span style='color:red'>No chances left, try after five minutes..</span>" + "<span style='color:red' id='email_counter'></span>");
                                document.getElementById('email_counter').innerHTML = " (" + email_otp_remains + " chances left)";
                                localStorage.setItem("email_otp_restricted", Date());
                                $('#otp_btn').val("Resend");
                                setTimeout(function () {
                                    $('#otp_btn').prop('disabled', false);
                                    localStorage.setItem("email_otp_remains", 5);
                                    email_otp_remains = localStorage.getItem('email_otp_remains');
                                    $('#success').html("You can sent otp now..");
                                    localStorage.removeItem('email_otp_restricted');
                                }, 300 * 1000);
                            } else {
                                otp_countdown();
                                $('#success').html("OTP Sent Successfully!! " + " Resend after " + "<span style='color:black' id='js-timeout-otp'>1:00</span> mins." + "<span style='color:red' id='email_counter'></span>");
                                document.getElementById('email_counter').innerHTML = " (" + email_otp_remains + " chances left)";
                                $('#otp_btn').val("Resend");
                            };
                        },
                        failure: function () {
                            $('#output').html("Internal error")
                        }
                    });
                } else {
                    $("#otp_btn").prop("disabled", false);
                    $('#output').html("5 tries passed,try after some time!")
                }
            } else {
                $("#otp_btn").prop("disabled", false);
                $('#output').html("Enter both email and username for OTP!!")
            }
        });
        $('#otp_verify').on('click', function (e) {
            e.preventDefault();
            $('#error_msg').html("");
            if (!otp_timer_status){
              $('#success').html("");
              }
            $('#output').html("");
            var email1 = document.getElementById("email").value;
            var otp = document.getElementById("otp").value;
            if (email1 != "" && otp != "") {
                $.ajax({
                    type: "POST",
                    url: "{% url 'register' %}",
                    data: {
                        form: 'verify_otp',
                        otp: $('#otp').val(),
                        email: $('#email').val(),
                        csrfmiddlewaretoken: '{{ csrf_token }}',
                        dataType: "json",
                    },
                    success: function (data) {
                        if (data.verified == "True") {
                            $('#output_otp').html("")
                            $('#success_otp').html("OTP Verified Successfully!!")
                            $('#otp_status').val("verified")
                        }
                        else {
                            $('#success_otp').html("")
                            $('#output_otp').html("Wrong OTP..")
                            $('#otp').val("")
                            $('#otp_status').val("")
                        }
                    },

                    failure: function () {
                        $('#output_otp').html("Internal Error")
                    }
                });
            } else {
                $('#success_otp').html("")
                $('#output_otp').html("Enter both email and otp for verification!!")
            }
        });

        $('#email').on('change', function () {
            $('#otp_status').val("")
            $('#success_otp').html("")
            $('#success').html("")
            $('#output_otp').html("")
            $('#output').html("")
            $('#error_msg').html("")

        });
        $('#phone').on('change', function () {
            $('#sms_status').val("")
            $('#success_sms').html("")
            $('#success1').html("")
            $('#output_sms').html("")
            $('#output1').html("")
            $('#error_msg').html("")

        });

        function form_validation() {
            $('#success_otp').html("")
            $('#success').html("")
            $('#output_otp').html("")
            $('#output').html("")
            $('#error_msg').html("")
            if ($('#otp_status').val() == "verified") {
                if ($('#sms_status').val() == "verified") {
                    return true
                } else {
                    $('#error_msg').html("Verify the mobile OTP first!")
                    return false
                }
            } else {
                $('#error_msg').html("Verify the email OTP first!")
                return false
            }
        }

  </script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.2.3/dist/js/bootstrap.bundle.min.js" integrity="sha384-kenU1KFdBIe4zVF0s0G1M5b4hcpxyD9F7jL+jjXkk+Q2h455rYXK/7HAuoJl+0I4" crossorigin="anonymous"></script>
  </body>
</html>


